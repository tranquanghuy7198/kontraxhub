import{r as m,R as O,j as e,N as v}from"./index-t4HIAyTE.js";import{I as z,T as P,B as S,G as V,u as L,J as $,L as q,F as i,e as j,S as H,N as J,c as W,E as X,M as G,H as K,g as _,d as N,D as Q,A as U}from"./index-vLbvcorX.js";import{C as Y}from"./index-K4QdAmvY.js";import{p as Z,A as ee,a as te}from"./index-CMEmWEzR.js";import{V as ae,S as T,g as se,h as re,v as oe,u as ne,b as ce,c as le,i as ie,j as de,k as me}from"./index-uvkTiwZu.js";var ue={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M908.1 353.1l-253.9-36.9L540.7 86.1c-3.1-6.3-8.2-11.4-14.5-14.5-15.8-7.8-35-1.3-42.9 14.5L369.8 316.2l-253.9 36.9c-7 1-13.4 4.3-18.3 9.3a32.05 32.05 0 00.6 45.3l183.7 179.1-43.4 252.9a31.95 31.95 0 0046.4 33.7L512 754l227.1 119.4c6.2 3.3 13.4 4.4 20.3 3.2 17.4-3 29.1-19.5 26.1-36.9l-43.4-252.9 183.7-179.1c5-4.9 8.3-11.3 9.3-18.3 2.7-17.5-9.5-33.7-27-36.3zM664.8 561.6l36.1 210.3L512 672.7 323.1 772l36.1-210.3-152.8-149L417.6 382 512 190.7 606.4 382l211.2 30.7-152.8 148.9z"}}]},name:"star",theme:"outlined"};function w(){return w=Object.assign?Object.assign.bind():function(t){for(var l=1;l<arguments.length;l++){var r=arguments[l];for(var c in r)Object.prototype.hasOwnProperty.call(r,c)&&(t[c]=r[c])}return t},w.apply(this,arguments)}const pe=(t,l)=>m.createElement(z,w({},t,{ref:l,icon:ue})),he=m.forwardRef(pe),fe=({checked:t,defaultChecked:l=!1,onChange:r})=>{const[c,u]=O.useState(l),o=t!==void 0,p=o?t:c;return e.jsx(P,{title:"Publish",placement:"left",children:e.jsx(S,{type:"text",shape:"circle",size:"small",icon:p?e.jsx(V,{className:"bookmark"}):e.jsx(he,{}),onClick:()=>{const x=!p;o||u(x),r?.({target:{checked:x}})}})})},xe=(t,l)=>({template:Z({id:t.templateId,name:t.name,desscription:t.description,abi:t.abi,bytecode:t.bytecode,flattenSource:t.flattenSource,programKeypair:"[]",networkClusters:l.filter(r=>t.addresses.some(c=>c.blockchainId===r.id)).map(r=>r.networkCluster.toString())}),addresses:t.addresses}),Ce=({contractForm:t,saveContract:l})=>{const{blockchains:r}=L(),[c]=$(),u=q("addresses",c),[o,p]=m.useState(!1);m.useEffect(()=>{t.open&&c.resetFields()},[c,t]);const x=async C=>{p(!0),await l({...C,templateId:t.form?.templateId??oe(),bytecode:t.form?.bytecode??"{}"}),p(!1)};return e.jsxs(i,{form:c,name:"save-contract",layout:"horizontal",initialValues:t.form,autoComplete:"off",onFinish:x,children:[e.jsx(i.Item,{name:"name",label:"Name",required:!0,children:e.jsx(j,{placeholder:"Contract Name",disabled:o})}),e.jsx(i.Item,{name:"description",label:"Description",children:e.jsx(j.TextArea,{placeholder:"Description",disabled:o})}),e.jsx(i.Item,{name:"abi",label:"ABI",required:!0,children:e.jsx(ae,{placeholder:"Contract ABI (EVM) or IDL (Solana)",disabled:o})}),e.jsx(i.Item,{name:"flattenSource",label:"Flatten Source",children:e.jsx(j.TextArea,{rows:4,placeholder:"Contract flatten source",disabled:o})}),e.jsx(i.Item,{label:"Addresses",tooltip:"By publishing this contract, you allow everyone to see and interact with it. To do so, you must be its owner or deployer",children:e.jsx(i.List,{name:"addresses",children:(C,{add:I,remove:k})=>e.jsxs("div",{className:"addresses",children:[C.map(d=>e.jsxs(H,{align:"baseline",children:[e.jsx(i.Item,{name:[d.name,"publicity"],valuePropName:"checked",children:e.jsx(fe,{})}),e.jsx(i.Item,{name:[d.name,"blockchainId"],children:e.jsx(J,{disabled:o,className:"contract-chain-select",placeholder:"Blockchain",options:r.slice().sort((n,h)=>n.code.localeCompare(h.code)).map(n=>({label:n.name,value:n.id,emoji:n.logo})),optionRender:n=>e.jsx(T,{icon:n.data.emoji,label:n.data.label}),labelRender:({value:n,label:h})=>{const g=r.find(f=>f.id===n);return g?e.jsx(T,{icon:g.logo,label:h}):h}})}),e.jsx(i.Item,{name:[d.name,"address"],children:e.jsx(j,{placeholder:"Address",disabled:o})}),u&&(r.find(n=>n.id===u[d.name]?.blockchainId)?.networkCluster===v.Sui||r.find(n=>n.id===u[d.name]?.blockchainId)?.networkCluster===v.Aptos)&&e.jsx(i.Item,{name:[d.name,"module"],children:e.jsx(j,{placeholder:"Module"})}),e.jsx(S,{type:"text",size:"small",icon:e.jsx(se,{}),disabled:o,onClick:()=>k(d.name)})]},d.key)),e.jsxs(S,{type:"dashed",onClick:()=>I(),block:!0,children:[e.jsx(re,{})," Add Address"]})]})})}),e.jsx(i.Item,{children:e.jsx(S,{type:"primary",htmlType:"submit",loading:o,children:"Save Contract"})})]})},Ie=()=>{const[t,l]=W(),{blockchains:r}=L(),{fetchPopularContracts:c}=ne(),{fetchTemplates:u}=ce(),{contracts:o,fetchContracts:p,contractLoading:x}=le(),{callAuthenticatedApi:C}=X(),[I,k]=m.useState([]),[d,n]=m.useState([]),[h,g]=m.useState(),[f,y]=m.useState({open:!1,form:void 0}),[A,E]=m.useState();m.useEffect(()=>{k(o.filter(s=>{if(h&&!s.template.name.toLowerCase().includes(h.toLowerCase()))return!1;for(const a of d)if(!r.filter(b=>s.addresses.map(R=>R.blockchainId).includes(b.id)).map(b=>b.networkCluster.toString()).includes(a))return!1;return!0}))},[o,r,d,h]);const D=s=>{try{return xe(s,r)}catch(a){throw t.error({message:"Invalid data",description:e.jsx(U,{ellipsis:{rows:4,expandable:!0,symbol:"View Full"},children:a instanceof Error?a.message:String(a)})}),a}},F=async s=>{try{await C(o.some(a=>a.template.id===s.template.id)?ie:de,s),await p(!0),u(!0),c(!0),t.success({message:"Contract Saved",description:"A contract has been saved"})}catch(a){t.error({message:"Error saving contract",description:a instanceof Error?a.message:String(a)})}finally{y({open:!1})}},M=s=>{const a=o.find(b=>b.template.id===s);a?y({open:!0,form:{templateId:a.template.id,name:a.template.name,description:a.template.description,abi:JSON.stringify(a.template.abi),bytecode:a.template.bytecode,flattenSource:a.template.flattenSource,addresses:a.addresses}}):t.error({message:"Contract not found"})},B=async s=>{if(s)try{await C(me,s),await p(!0),u(!0),c(!0),t.success({message:"Contract Deleted",description:"A contract has been deleted"})}catch(a){t.error({message:"Error deleting contract",description:a instanceof Error?a.message:String(a)})}};return e.jsxs(G,{loading:x,children:[l,e.jsx(ee,{}),e.jsx(K,{header:"Contract Explorer",options:Object.values(v).map(s=>({value:s.toString(),label:_(s.toString())})),onSelected:n,onSearched:g,onAddRequested:()=>y({open:!0,form:void 0}),defaultSelectAll:!1}),e.jsx("div",{className:"masonry-container",children:e.jsx(N.XMasonry,{center:!1,targetBlockWidth:300,children:I.map(s=>e.jsx(N.XBlock,{children:e.jsx(Y,{contract:s,onDeleteContract:E,onEditContract:M})},s.template.id))})}),e.jsx(Q,{width:800,title:f.form?f.form.name:"Add Contract",open:f.open,closable:!0,onClose:()=>y({...f,open:!1}),children:e.jsx(Ce,{contractForm:f,saveContract:s=>F(D(s))})}),e.jsx(te,{showModal:A!==void 0,danger:!0,onOk:()=>B(A),onCancel:()=>E(void 0),title:"Delete this contract?",description:"This action cannot be undone. All information associated with this contract will be lost.",okText:"Delete Contract"})]})};export{Ie as default};
//# sourceMappingURL=index-Bre1JDTm.js.map

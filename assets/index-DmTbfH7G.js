import{r as m,R as z,j as e,N as w}from"./index-DOlQ3qtd.js";import{I as V,T as $,B as I,v as q,u as L,w as H,x as W,F as i,c as g,S as X,y as J,b as K,t as _,M as G,H as Q,d as D,D as U}from"./index-BBmxxdpq.js";import{C as Y}from"./index-H7NaB1DL.js";import{V as Z,S as F,j as ee,k as te,v as ae,u as se,e as oe,f as re,c as ne,a as ce,l as le,m as ie,P as de,n as me}from"./index-B0bYKvTH.js";import{p as pe,A as ue,a as he}from"./index-BBkXLyz1.js";var fe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M908.1 353.1l-253.9-36.9L540.7 86.1c-3.1-6.3-8.2-11.4-14.5-14.5-15.8-7.8-35-1.3-42.9 14.5L369.8 316.2l-253.9 36.9c-7 1-13.4 4.3-18.3 9.3a32.05 32.05 0 00.6 45.3l183.7 179.1-43.4 252.9a31.95 31.95 0 0046.4 33.7L512 754l227.1 119.4c6.2 3.3 13.4 4.4 20.3 3.2 17.4-3 29.1-19.5 26.1-36.9l-43.4-252.9 183.7-179.1c5-4.9 8.3-11.3 9.3-18.3 2.7-17.5-9.5-33.7-27-36.3zM664.8 561.6l36.1 210.3L512 672.7 323.1 772l36.1-210.3-152.8-149L417.6 382 512 190.7 606.4 382l211.2 30.7-152.8 148.9z"}}]},name:"star",theme:"outlined"};function A(){return A=Object.assign?Object.assign.bind():function(t){for(var l=1;l<arguments.length;l++){var o=arguments[l];for(var c in o)Object.prototype.hasOwnProperty.call(o,c)&&(t[c]=o[c])}return t},A.apply(this,arguments)}const xe=(t,l)=>m.createElement(V,A({},t,{ref:l,icon:fe})),be=m.forwardRef(xe),Ce=({checked:t,defaultChecked:l=!1,onChange:o})=>{const[c,p]=z.useState(l),r=t!==void 0,u=r?t:c;return e.jsx($,{title:"Publish",placement:"left",children:e.jsx(I,{type:"text",shape:"circle",size:"small",icon:u?e.jsx(q,{className:"bookmark"}):e.jsx(be,{}),onClick:()=>{const b=!u;r||p(b),o?.({target:{checked:b}})}})})},je=(t,l)=>({template:pe({id:t.templateId,name:t.name,desscription:t.description,abi:t.abi,bytecode:t.bytecode,flattenSource:t.flattenSource,programKeypair:"[]",networkClusters:l.filter(o=>t.addresses.some(c=>c.blockchainId===o.id)).map(o=>o.networkCluster.toString())}),addresses:t.addresses}),ge=({contractForm:t,saveContract:l})=>{const{blockchains:o}=L(),[c]=H(),p=W("addresses",c),[r,u]=m.useState(!1);m.useEffect(()=>{t.open&&c.resetFields()},[c,t]);const b=async C=>{u(!0),await l({...C,templateId:t.form?.templateId??ae(),bytecode:t.form?.bytecode??"{}"}),u(!1)};return e.jsxs(i,{form:c,name:"save-contract",layout:"horizontal",initialValues:t.form,autoComplete:"off",onFinish:b,children:[e.jsx(i.Item,{name:"name",label:"Name",required:!0,children:e.jsx(g,{placeholder:"Contract Name",disabled:r})}),e.jsx(i.Item,{name:"description",label:"Description",children:e.jsx(g.TextArea,{placeholder:"Description",disabled:r})}),e.jsx(i.Item,{name:"abi",label:"ABI",required:!0,children:e.jsx(Z,{placeholder:"Contract ABI (EVM) or IDL (Solana)",disabled:r})}),e.jsx(i.Item,{name:"flattenSource",label:"Flatten Source",children:e.jsx(g.TextArea,{rows:4,placeholder:"Contract flatten source",disabled:r})}),e.jsx(i.Item,{label:"Addresses",tooltip:"By publishing this contract, you allow everyone to see and interact with it. To do so, you must be its owner or deployer",children:e.jsx(i.List,{name:"addresses",children:(C,{add:k,remove:v})=>e.jsxs("div",{className:"addresses",children:[C.map(d=>e.jsxs(X,{align:"baseline",children:[e.jsx(i.Item,{name:[d.name,"publicity"],valuePropName:"checked",children:e.jsx(Ce,{})}),e.jsx(i.Item,{name:[d.name,"blockchainId"],children:e.jsx(J,{disabled:r,className:"contract-chain-select",placeholder:"Blockchain",options:o.slice().sort((n,h)=>n.code.localeCompare(h.code)).map(n=>({label:n.name,value:n.id,emoji:n.logo})),optionRender:n=>e.jsx(F,{icon:n.data.emoji,label:n.data.label}),labelRender:({value:n,label:h})=>{const S=o.find(f=>f.id===n);return S?e.jsx(F,{icon:S.logo,label:h}):h}})}),e.jsx(i.Item,{name:[d.name,"address"],children:e.jsx(g,{placeholder:"Address",disabled:r})}),p&&(o.find(n=>n.id===p[d.name]?.blockchainId)?.networkCluster===w.Sui||o.find(n=>n.id===p[d.name]?.blockchainId)?.networkCluster===w.Aptos)&&e.jsx(i.Item,{name:[d.name,"module"],children:e.jsx(g,{placeholder:"Module"})}),e.jsx(I,{type:"text",size:"small",icon:e.jsx(ee,{}),disabled:r,onClick:()=>v(d.name)})]},d.key)),e.jsxs(I,{type:"dashed",onClick:()=>k(),block:!0,children:[e.jsx(te,{})," Add Address"]})]})})}),e.jsx(i.Item,{children:e.jsx(I,{type:"primary",htmlType:"submit",loading:r,children:"Save Contract"})})]})},we=()=>{const[t,l]=K(),{blockchains:o}=L(),{fetchPopularContracts:c}=se(),{fetchTemplates:p}=oe(),{contracts:r,fetchContracts:u,contractLoading:b}=re(),{callAuthenticatedApi:C}=_(),[k,v]=m.useState([]),[d,n]=m.useState([]),[h,S]=m.useState(),[f,y]=m.useState({open:!1,form:void 0}),[E,N]=m.useState(),[j,T]=m.useState({open:!1});m.useEffect(()=>{v(r.filter(s=>{if(h&&!s.template.name.toLowerCase().includes(h.toLowerCase()))return!1;for(const a of d)if(!o.filter(x=>s.addresses.map(P=>P.blockchainId).includes(x.id)).map(x=>x.networkCluster.toString()).includes(a))return!1;return!0}))},[r,o,d,h]);const M=s=>{try{return je(s,o)}catch(a){throw t.error({message:"Invalid data",description:e.jsx(de,{ellipsis:{rows:4,expandable:!0,symbol:"View Full"},children:a instanceof Error?a.message:String(a)})}),a}},B=async s=>{try{await C(r.some(a=>a.template.id===s.template.id)?le:ie,s),await u(!0),p(!0),c(!0),t.success({message:"Contract Saved",description:"A contract has been saved"})}catch(a){t.error({message:"Error saving contract",description:a instanceof Error?a.message:String(a)})}finally{y({open:!1})}},R=s=>{const a=r.find(x=>x.template.id===s);a?y({open:!0,form:{templateId:a.template.id,name:a.template.name,description:a.template.description,abi:JSON.stringify(a.template.abi),bytecode:a.template.bytecode,flattenSource:a.template.flattenSource,addresses:a.addresses}}):t.error({message:"Contract not found"})},O=async s=>{if(s)try{await C(me,s),await u(!0),p(!0),c(!0),t.success({message:"Contract Deleted",description:"A contract has been deleted"})}catch(a){t.error({message:"Error deleting contract",description:a instanceof Error?a.message:String(a)})}};return e.jsxs(G,{loading:b,children:[l,e.jsx(ue,{}),e.jsx(Q,{header:"Contract Explorer",options:Object.values(w).map(s=>({value:s.toString(),label:ne(s.toString())})),onSelected:n,onSearched:S,onAddRequested:()=>y({open:!0,form:void 0}),defaultSelectAll:!1}),e.jsx("div",{className:"masonry-container",children:e.jsx(D.XMasonry,{center:!1,targetBlockWidth:300,children:k.map(s=>e.jsx(D.XBlock,{children:e.jsx(Y,{contract:s,onDelete:N,onEdit:R,onInteract:(a,x)=>T({template:a,address:x,open:!0})})},s.template.id))})}),e.jsx(U,{width:800,title:f.form?f.form.name:"Add Contract",open:f.open,closable:!0,onClose:()=>y({...f,open:!1}),children:e.jsx(ge,{contractForm:f,saveContract:s=>B(M(s))})}),e.jsx(ce,{open:j.open,template:j.template,address:j.address,blockchain:o.find(s=>s.id===j.address?.blockchainId),onClose:()=>T({...j,open:!1})}),e.jsx(he,{showModal:E!==void 0,danger:!0,onOk:()=>O(E),onCancel:()=>N(void 0),title:"Delete this contract?",description:"This action cannot be undone. All information associated with this contract will be lost.",okText:"Delete Contract"})]})};export{we as default};
//# sourceMappingURL=index-DmTbfH7G.js.map

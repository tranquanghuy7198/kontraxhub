import{r as m,R as V,q as e,N as A}from"./index-DdRRVCeq.js";import{I as q,T as $,M as k,a9 as H,A as B,y as J,D as W,E as i,J as g,a7 as X,S as G,G as L,N as K,z as Q,a8 as U,O as _,P as Y,H as Z,Q as M,U as ee}from"./index-B6-BJTYl.js";import{C as te}from"./index-B4jDJDHN.js";import{p as ae,A as se}from"./index-Dzz-nxNd.js";import{V as oe,h as ne,i as re,u as ce,c as le,d as ie,a as de,j as me,k as pe,P as ue,l as he}from"./index-jatYtx4u.js";import{C as fe}from"./index-D75C4EBG.js";var Ce={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M908.1 353.1l-253.9-36.9L540.7 86.1c-3.1-6.3-8.2-11.4-14.5-14.5-15.8-7.8-35-1.3-42.9 14.5L369.8 316.2l-253.9 36.9c-7 1-13.4 4.3-18.3 9.3a32.05 32.05 0 00.6 45.3l183.7 179.1-43.4 252.9a31.95 31.95 0 0046.4 33.7L512 754l227.1 119.4c6.2 3.3 13.4 4.4 20.3 3.2 17.4-3 29.1-19.5 26.1-36.9l-43.4-252.9 183.7-179.1c5-4.9 8.3-11.3 9.3-18.3 2.7-17.5-9.5-33.7-27-36.3zM664.8 561.6l36.1 210.3L512 672.7 323.1 772l36.1-210.3-152.8-149L417.6 382 512 190.7 606.4 382l211.2 30.7-152.8 148.9z"}}]},name:"star",theme:"outlined"};function E(){return E=Object.assign?Object.assign.bind():function(t){for(var l=1;l<arguments.length;l++){var o=arguments[l];for(var c in o)Object.prototype.hasOwnProperty.call(o,c)&&(t[c]=o[c])}return t},E.apply(this,arguments)}const be=(t,l)=>m.createElement(q,E({},t,{ref:l,icon:Ce})),xe=m.forwardRef(be),je=({checked:t,defaultChecked:l=!1,onChange:o})=>{const[c,p]=V.useState(l),n=t!==void 0,u=n?t:c;return e.jsx($,{title:"Publish",placement:"left",children:e.jsx(k,{type:"text",shape:"circle",size:"small",icon:u?e.jsx(H,{className:"bookmark"}):e.jsx(xe,{}),onClick:()=>{const C=!u;n||p(C),o?.({target:{checked:C}})}})})},ge=(t,l)=>({template:ae({id:t.templateId,name:t.name,desscription:t.description,abi:t.abi,bytecode:t.bytecode,flattenSource:t.flattenSource,programKeypair:"[]",networkClusters:l.filter(o=>t.addresses.some(c=>c.blockchainId===o.id)).map(o=>o.networkCluster.toString())}),addresses:t.addresses}),ye=({contractForm:t,saveContract:l})=>{const{blockchains:o}=B(),[c]=J(),p=W("addresses",c),[n,u]=m.useState(!1);m.useEffect(()=>{t.open&&c.resetFields()},[c,t]);const C=async b=>{u(!0),await l({...b,templateId:t.form?.templateId??K(),bytecode:t.form?.bytecode??"{}"}),u(!1)};return e.jsxs(i,{form:c,name:"save-contract",layout:"horizontal",initialValues:t.form,autoComplete:"off",onFinish:C,children:[e.jsx(i.Item,{name:"name",label:"Name",required:!0,children:e.jsx(g,{placeholder:"Contract Name",disabled:n})}),e.jsx(i.Item,{name:"description",label:"Description",children:e.jsx(g.TextArea,{placeholder:"Description",disabled:n})}),e.jsx(i.Item,{name:"abi",label:"ABI",required:!0,children:e.jsx(oe,{placeholder:"Contract ABI (EVM) or IDL (Solana)",disabled:n})}),e.jsx(i.Item,{name:"flattenSource",label:"Flatten Source",children:e.jsx(g.TextArea,{rows:4,placeholder:"Contract flatten source",disabled:n})}),e.jsx(i.Item,{label:"Addresses",tooltip:"By publishing this contract, you allow everyone to see and interact with it. To do so, you must be its owner or deployer",children:e.jsx(i.List,{name:"addresses",children:(b,{add:I,remove:w})=>e.jsxs("div",{className:"addresses",children:[b.map(d=>e.jsxs(X,{align:"baseline",children:[e.jsx(i.Item,{name:[d.name,"publicity"],valuePropName:"checked",children:e.jsx(je,{})}),e.jsx(i.Item,{name:[d.name,"blockchainId"],children:e.jsx(G,{disabled:n,className:"contract-chain-select",placeholder:"Blockchain",options:o.slice().sort((r,h)=>r.code.localeCompare(h.code)).map(r=>({label:r.name,value:r.id,emoji:r.logo})),optionRender:r=>e.jsx(L,{icon:r.data.emoji,label:r.data.label}),labelRender:({value:r,label:h})=>{const y=o.find(f=>f.id===r);return y?e.jsx(L,{icon:y.logo,label:h}):h}})}),e.jsx(i.Item,{name:[d.name,"address"],children:e.jsx(g,{placeholder:"Address",disabled:n})}),p&&(o.find(r=>r.id===p[d.name]?.blockchainId)?.networkCluster===A.Sui||o.find(r=>r.id===p[d.name]?.blockchainId)?.networkCluster===A.Aptos)&&e.jsx(i.Item,{name:[d.name,"module"],children:e.jsx(g,{placeholder:"Module"})}),e.jsx(k,{type:"text",size:"small",icon:e.jsx(ne,{}),disabled:n,onClick:()=>w(d.name)})]},d.key)),e.jsx(k,{type:"dashed",block:!0,icon:e.jsx(re,{}),onClick:()=>I(),children:"Add Address"})]})})}),e.jsx(i.Item,{children:e.jsx(k,{type:"primary",htmlType:"submit",loading:n,children:"Save Contract"})})]})},Ee=()=>{const[t,l]=Q(),{blockchains:o}=B(),{fetchPopularContracts:c}=ce(),{fetchTemplates:p}=le(),{contracts:n,fetchContracts:u,contractLoading:C}=ie(),{callAuthenticatedApi:b}=U(),[I,w]=m.useState([]),[d,r]=m.useState([]),[h,y]=m.useState(),[f,S]=m.useState({open:!1,form:void 0}),[N,T]=m.useState(),[j,D]=m.useState({open:!1});m.useEffect(()=>{w(n.filter(s=>{if(h&&!s.template.name.toLowerCase().includes(h.toLowerCase()))return!1;for(const a of d)if(!o.filter(x=>s.addresses.map(v=>v.blockchainId).includes(x.id)).map(x=>x.networkCluster.toString()).includes(a))return!1;return!0}))},[n,o,d,h]);const O=s=>{try{return ge(s,o)}catch(a){throw t.error({message:"Invalid data",description:e.jsx(ue,{ellipsis:{rows:4,expandable:!0,symbol:"View Full"},children:a instanceof Error?a.message:String(a)})}),a}},R=async s=>{try{await b(n.some(a=>a.template.id===s.template.id)?me:pe,s),await u(!0),p(!0),c(!0),t.success({message:"Contract Saved",description:"A contract has been saved"})}catch(a){t.error({message:"Error saving contract",description:a instanceof Error?a.message:String(a)})}finally{S({open:!1})}},F=s=>{const a=n.find(x=>x.template.id===s);a?S({open:!0,form:{templateId:a.template.id,name:a.template.name,description:a.template.description,abi:JSON.stringify(a.template.abi),bytecode:a.template.bytecode,flattenSource:a.template.flattenSource,addresses:a.addresses}}):t.error({message:"Contract not found"})},z=async s=>{if(s)try{await b(he,s),await u(!0),p(!0),c(!0),t.success({message:"Contract Deleted",description:"A contract has been deleted"})}catch(a){t.error({message:"Error deleting contract",description:a instanceof Error?a.message:String(a)})}},P=(s,a)=>{o.find(v=>v.id===a.blockchainId)?D({template:s,address:a,open:!0}):t.error({message:"Blockchain not found",description:"This blockchain is not supported anymore, or your customized blockchain was deleted."})};return e.jsxs(_,{loading:C,children:[l,e.jsx(se,{}),e.jsx(Y,{header:"Contract Explorer",options:Object.values(A).map(s=>({value:s.toString(),label:Z(s.toString())})),onSelected:r,onSearched:y,onAddRequested:()=>S({open:!0,form:void 0}),defaultSelectAll:!1}),e.jsx("div",{className:"masonry-container",children:e.jsx(M.XMasonry,{center:!1,targetBlockWidth:300,children:I.map(s=>e.jsx(M.XBlock,{children:e.jsx(te,{contract:s,onDelete:T,onEdit:F,onInteract:P})},s.template.id))})}),e.jsx(ee,{width:800,title:f.form?f.form.name:"Add Contract",open:f.open,closable:!0,onClose:()=>S({...f,open:!1}),children:e.jsx(ye,{contractForm:f,saveContract:s=>R(O(s))})}),e.jsx(de,{open:j.open,template:j.template,address:j.address,blockchain:o.find(s=>s.id===j.address?.blockchainId),onClose:()=>D({...j,open:!1})}),e.jsx(fe,{showModal:N!==void 0,danger:!0,onOk:()=>z(N),onCancel:()=>T(void 0),title:"Delete this contract?",description:"This action cannot be undone. All information associated with this contract will be lost.",okText:"Delete Contract"})]})};export{Ee as default};
//# sourceMappingURL=index-Ch4QGM1D.js.map
